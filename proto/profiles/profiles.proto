syntax = "proto3";
package profile;

option go_package = "github.com/chains-lab/profiles-proto/gen/go/svc;svc";

import "google/protobuf/empty.proto";
import "common/userdata/userdata.proto";
import "common/pagination/pagination.proto";

service Profiles {
  rpc CreateOwnProfile (CreateProfileRequest) returns (Profile);
  rpc GetOwnProfile   (google.protobuf.Empty) returns (Profile);

  rpc GetProfileById (GetProfileByIdRequest) returns (Profile);
  rpc GetProfileByUsername (GetProfileByUsernameRequest) returns (Profile);
  rpc SearchProfilesByUsername (SearchProfilesByUsernameRequest) returns (ProfilesList);

  rpc UpdateOwnProfile (UpdateOwnProfileRequest) returns (Profile);
  rpc UpdateOwnUsername (UpdateOwnUsernameRequest) returns (Profile);

  // Admin panel
  rpc ResetProfileByAdmin (ResetProfileByAdminRequest) returns (Profile);
  rpc ResetUsernameByAdmin (ResetUsernameByAdminRequest) returns (Profile);
  rpc UpdateOfficialByAdmin (UpdateOfficialByAdminRequest) returns (Profile);
}

// REQUESTS
message CreateProfileRequest {
  userdata.UserData initiator = 1;
  string username = 2;
  optional string pseudonym = 3;
  optional string description = 4;
  optional string avatar = 5;
  optional string sex = 6;
  optional string birth_date = 7; // Format: YYYY-MM-DD
}

message GetProfileByIdRequest {
  string user_id  = 1;
}

message GetProfileByUsernameRequest {
  string username = 1;
}

message SearchProfilesByUsernameRequest {
  string prompt = 1;
  pagination.Response pagination = 2;
}

message UpdateOwnProfileRequest {
  userdata.UserData initiator = 1;
  optional string pseudonym = 2;
  optional string description = 3;
  optional string avatar = 4;
  optional string sex = 5;
  optional string birth_date = 6; // Format: YYYY-MM-DD
}

message UpdateOwnUsernameRequest {
  userdata.UserData initiator = 1;
  string username = 2;
}

message UpdateOfficialByAdminRequest {
  userdata.UserData initiator = 1;
  string user_id = 2;
  bool official = 3;
}

message ResetUsernameByAdminRequest {
  userdata.UserData initiator = 1;
  string user_id = 2;
  string username = 3;
}

message ResetProfileByAdminRequest {
  userdata.UserData initiator = 1;
  string user_id = 2;
  optional string pseudonym = 3;
  optional string description = 4;
  optional string avatar = 5;
}

// RESPONSES

message Profile {
  string user_id = 1;
  string username = 2;
  optional string pseudonym = 3;
  optional string description = 4;
  optional string avatar = 5;
  bool official = 6;
  optional string sex = 7;
  optional string birth_date = 8; // Format: YYYY-MM-DD
  string updated_at = 9;
  string created_at = 10;
}

message ProfilesList {
  repeated Profile profiles = 1;
  pagination.Request pagination = 2;
}