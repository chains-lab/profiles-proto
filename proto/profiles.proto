syntax = "proto3";
package profile;

option go_package = "github.com/chains-lab/profiles-proto/gen/go/svc;svc";

import "google/protobuf/empty.proto";
import "common.proto";

service ProfileService {
  rpc CreateOwnProfile (CreateProfileRequest) returns (ProfileModel);
  rpc GetOwnProfile   (google.protobuf.Empty) returns (ProfileModel);

  rpc GetProfileById (GetProfileByIdRequest) returns (ProfileModel);
  rpc GetProfileByUsername (GetProfileByUsernameRequest) returns (ProfileModel);
  rpc SearchProfilesByUsername (SearchProfilesByUsernameRequest) returns (ProfileModelList);

  rpc UpdateOwnProfile (UpdateOwnProfileRequest) returns (ProfileModel);
  rpc UpdateOwnUsername (UpdateOwnUsernameRequest) returns (ProfileModel);

  // Admin panel
  rpc ResetProfileByAdmin (ResetProfileByAdminRequest) returns (ProfileModel);
  rpc ResetUsernameByAdmin (ResetUsernameByAdminRequest) returns (ProfileModel);
  rpc UpdateOfficialByAdmin (UpdateOfficialByAdminRequest) returns (ProfileModel);
}

// REQUESTS
message CreateProfileRequest {
  string username = 1;
  optional string pseudonym = 2;
  optional string description = 3;
  optional string avatar = 4;
  optional string sex = 5;
  optional string birth_date = 6; // Format: YYYY-MM-DD
}

message GetProfileByIdRequest {
  string user_id  = 1;
}

message GetProfileByUsernameRequest {
  string username = 1;
}

message SearchProfilesByUsernameRequest {
  string prompt = 1;
  PaginationRequest pagination = 2;
}

message UpdateOwnProfileRequest {
  optional string pseudonym = 1;
  optional string description = 2;
  optional string avatar = 3;
  optional string sex = 4;
  optional string birth_date = 5; // Format: YYYY-MM-DD
}

message UpdateOwnUsernameRequest {
  string username = 1;
}

message GetCabinetByAdminRequest {
  string user_id = 1;
}

message GetProfileByAdminRequest {
  string user_id = 1;
}

message ResetProfileByAdminRequest {
  string user_id = 1;
  optional bool   pseudonym = 2;
  optional bool   description = 3;
  optional bool   avatar = 4;
}

message UpdateOfficialByAdminRequest {
  string user_id = 1;
  bool official = 2;
}

message ResetUsernameByAdminRequest {
  string user_id = 1;
  string username = 2;
}

// RESPONSES

message ProfileModel {
  string user_id = 1;
  string username = 2;
  optional string pseudonym = 3;
  optional string description = 4;
  optional string avatar = 5;
  bool official = 6;
  optional string sex = 7;
  optional string birth_date = 8; // Format: YYYY-MM-DD
  string updated_at = 9;
  string created_at = 10;
}

message ProfileModelList {
  repeated ProfileModel profiles = 1;
  PaginationResponse pagination = 2;
}